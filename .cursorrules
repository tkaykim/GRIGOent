# GRIGOent ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë° ê°œë°œ ê°€ì´ë“œë¼ì¸

## ğŸ“Š í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°

### ğŸ” Auth ìŠ¤í‚¤ë§ˆ (Supabase ê¸°ë³¸)
- **users**: ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´ (id, email, role, created_at ë“±)
- **sessions**: ì‚¬ìš©ì ì„¸ì…˜ ê´€ë¦¬
- **identities**: ì†Œì…œ ë¡œê·¸ì¸ ì—°ë™ ì •ë³´
- **flow_state**: ì¸ì¦ í”Œë¡œìš° ìƒíƒœ
- **mfa_***: ë‹¤ì¤‘ ì¸ì¦ ê´€ë ¨ í…Œì´ë¸”ë“¤

### ğŸ­ Public ìŠ¤í‚¤ë§ˆ (ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„°)

#### ì‚¬ìš©ì ê´€ë¦¬
```sql
-- users í…Œì´ë¸”
id: uuid (PK)
email: text (NOT NULL)
name: text
role: text (NOT NULL, DEFAULT 'client')
phone: text
is_active: boolean (DEFAULT true)
created_at: timestamp with time zone (DEFAULT now())
updated_at: timestamp with time zone (DEFAULT now())
```

#### ì•„í‹°ìŠ¤íŠ¸ ê´€ë¦¬
```sql
-- artists í…Œì´ë¸”
id: uuid (PK, DEFAULT gen_random_uuid())
user_id: uuid (FK to auth.users)
profile_image: text
type: text (NOT NULL, DEFAULT 'main')
artist_type: text (NOT NULL, DEFAULT 'main') -- 'main', 'choreographer', 'partner_choreographer'
bio: text
youtube_links: text[]
team_id: uuid (FK to teams)
order: integer (DEFAULT 0)
name_ko: text (NOT NULL, DEFAULT '')
name_en: text
name_ja: text
name_zh: text
created_at: timestamp with time zone (DEFAULT now())
updated_at: timestamp with time zone (DEFAULT now())

-- artists_careers í…Œì´ë¸”
id: uuid (PK, DEFAULT gen_random_uuid())
artist_id: uuid (FK to artists)
type: text (NOT NULL)
title: text (NOT NULL)
detail: text
country: text
video_url: text
created_at: timestamp with time zone (DEFAULT now())
```

#### íŒ€ ê´€ë¦¬
```sql
-- teams í…Œì´ë¸”
id: uuid (PK, DEFAULT gen_random_uuid())
name: text (NOT NULL)
profile_image: text
members: uuid[]
bio: text
created_at: timestamp with time zone (DEFAULT now())
updated_at: timestamp with time zone (DEFAULT now())
```

#### ë¬¸ì˜ ê´€ë¦¬
```sql
-- inquiries í…Œì´ë¸”
id: uuid (PK, DEFAULT gen_random_uuid())
artist_name: text (NOT NULL)
manager_name: text (NOT NULL)
start_date: text
end_date: text
approximate_date: text
type: text
place: text
budget: integer
currency: text
budget_undecided: boolean (DEFAULT false)
email: text
phone: text
message: text
created_at: timestamp with time zone (DEFAULT now())

-- inquiry_types í…Œì´ë¸”
id: integer (PK, AUTO_INCREMENT)
name: text (NOT NULL)
```

#### ê¸°íƒ€
```sql
-- roles í…Œì´ë¸”
id: integer (PK, AUTO_INCREMENT)
name: text (NOT NULL)

-- currencies í…Œì´ë¸”
id: integer (PK, AUTO_INCREMENT)
code: text (NOT NULL)
name: text (NOT NULL)
```

## ğŸ†• ì•„í‹°ìŠ¤íŠ¸ íƒ€ì… í™•ì¥ (ì „ì†/íŒŒíŠ¸ë„ˆ ì•ˆë¬´ê°€)

### ê¸°ì¡´ artists í…Œì´ë¸”ì— ì¶”ê°€í•  ì»¬ëŸ¼
```sql
-- artists í…Œì´ë¸”ì— ì¶”ê°€í•  ì»¬ëŸ¼
artist_type: text (NOT NULL, DEFAULT 'main') -- 'main', 'choreographer', 'partner_choreographer'
user_id: uuid (FK to auth.users) -- ì „ì†/íŒŒíŠ¸ë„ˆ ì•ˆë¬´ê°€ ê³„ì •ê³¼ ì—°ê²°
```

### ì•„í‹°ìŠ¤íŠ¸ íƒ€ì…ë³„ êµ¬ë¶„
- **main**: ì¼ë°˜ ì•„í‹°ìŠ¤íŠ¸ (ê¸°ì¡´)
- **choreographer**: ì „ì†ì•ˆë¬´ê°€ (ìƒˆë¡œ ì¶”ê°€)
- **partner_choreographer**: íŒŒíŠ¸ë„ˆì•ˆë¬´ê°€ (ìƒˆë¡œ ì¶”ê°€)

### RLS (Row Level Security) ì •ì±…
```sql
-- ì „ì†/íŒŒíŠ¸ë„ˆ ì•ˆë¬´ê°€ëŠ” ìì‹ ì˜ í”„ë¡œí•„ë§Œ ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "Choreographers can update own profile" ON artists
  FOR UPDATE USING (
    auth.uid() = user_id AND 
    artist_type IN ('choreographer', 'partner_choreographer')
  );

-- ì „ì†/íŒŒíŠ¸ë„ˆ ì•ˆë¬´ê°€ëŠ” ìì‹ ì˜ ê²½ë ¥ë§Œ ê´€ë¦¬ ê°€ëŠ¥
CREATE POLICY "Choreographers can manage own careers" ON artists_careers
  FOR ALL USING (
    auth.uid() = (
      SELECT user_id FROM artists 
      WHERE id = artists_careers.artist_id AND 
      artist_type IN ('choreographer', 'partner_choreographer')
    )
  );
```

## ğŸ‘¥ ì‚¬ìš©ì ê¶Œí•œ ì‹œìŠ¤í…œ

### ê¶Œí•œ ë ˆë²¨
1. **client**: ì¼ë°˜ í´ë¼ì´ì–¸íŠ¸ (ê¸°ë³¸ê°’)
2. **choreographer**: ì „ì†ì•ˆë¬´ê°€
3. **partner_choreographer**: íŒŒíŠ¸ë„ˆì•ˆë¬´ê°€
4. **admin**: ê´€ë¦¬ì

### ê¶Œí•œë³„ ì ‘ê·¼ ê°€ëŠ¥ í˜ì´ì§€
- **client**: í™ˆ, ì•„í‹°ìŠ¤íŠ¸ ëª©ë¡/ìƒì„¸, ë¬¸ì˜
- **choreographer**: í™ˆ, ëŒ€ì‹œë³´ë“œ, í”„ë¡œí•„ ê´€ë¦¬, ê²½ë ¥ ê´€ë¦¬
- **partner_choreographer**: í™ˆ, ëŒ€ì‹œë³´ë“œ, í”„ë¡œí•„ ê´€ë¦¬, ê²½ë ¥ ê´€ë¦¬
- **admin**: ëª¨ë“  í˜ì´ì§€ + ê´€ë¦¬ì í˜ì´ì§€

## ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œë¼ì¸

### 1. ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ì‹œ ì£¼ì˜ì‚¬í•­
- ëª¨ë“  í…Œì´ë¸”ì— `created_at`, `updated_at` íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
- UUID ì‚¬ìš© ì‹œ `gen_random_uuid()` ê¸°ë³¸ê°’ ì„¤ì •
- ì™¸ë˜í‚¤ ê´€ê³„ ëª…ì‹œì  ì„¤ì •
- RLS ì •ì±…ìœ¼ë¡œ ë°ì´í„° ë³´ì•ˆ ê°•í™”

### 2. ì‚¬ìš©ì ì¸ì¦ ë° ê¶Œí•œ
- Supabase Auth ì‚¬ìš©
- `auth.users` í…Œì´ë¸”ì˜ `raw_user_meta_data`ì— ì¶”ê°€ ì •ë³´ ì €ì¥
- ê¶Œí•œë³„ í˜ì´ì§€ ì ‘ê·¼ ì œì–´ êµ¬í˜„

### 3. íŒŒì¼ ì—…ë¡œë“œ
- Supabase Storage ì‚¬ìš©
- í”„ë¡œí•„ ì´ë¯¸ì§€, ê²½ë ¥ ê´€ë ¨ ë¯¸ë””ì–´ íŒŒì¼ ì €ì¥
- ì ì ˆí•œ ë²„í‚· ê¶Œí•œ ì„¤ì •

### 4. API ì„¤ê³„ ì›ì¹™
- RESTful API ì„¤ê³„
- ì ì ˆí•œ HTTP ìƒíƒœ ì½”ë“œ ì‚¬ìš©
- ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…

### 5. í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œ
- Next.js 15 + TypeScript ì‚¬ìš©
- ì»´í¬ë„ŒíŠ¸ ì¬ì‚¬ìš©ì„± ê³ ë ¤
- ë°˜ì‘í˜• ë””ìì¸ ì ìš©
- ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´/ì˜ì–´/ì¼ë³¸ì–´/ì¤‘êµ­ì–´)

### 6. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­
- RLS ì •ì±…ìœ¼ë¡œ ë°ì´í„° ì ‘ê·¼ ì œì–´
- ì…ë ¥ê°’ ê²€ì¦ ë° sanitization
- XSS, CSRF ë°©ì–´
- ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ (ë¯¼ê°í•œ ì •ë³´ ë…¸ì¶œ ê¸ˆì§€)

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ auth/              # ì¸ì¦ ê´€ë ¨ í˜ì´ì§€
â”‚   â”œâ”€â”€ choreographer/     # ì „ì†ì•ˆë¬´ê°€ ê´€ë ¨ í˜ì´ì§€
â”‚   â”œâ”€â”€ choreographers/    # ì „ì†ì•ˆë¬´ê°€ ëª©ë¡/ìƒì„¸
â”‚   â”œâ”€â”€ artists/          # ì•„í‹°ìŠ¤íŠ¸ ê´€ë ¨ í˜ì´ì§€
â”‚   â””â”€â”€ admin/            # ê´€ë¦¬ì í˜ì´ì§€
â”œâ”€â”€ components/            # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ utils/                # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
â””â”€â”€ locales/              # ë‹¤êµ­ì–´ ë¦¬ì†ŒìŠ¤
```

## ğŸ”„ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œ ê³ ë ¤ì‚¬í•­
1. ê¸°ì¡´ ë°ì´í„° ë°±ì—…
2. ìƒˆë¡œìš´ í…Œì´ë¸” ìƒì„±
3. RLS ì •ì±… ì ìš©
4. ì¸ë±ìŠ¤ ìµœì í™”
5. ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦

## ğŸ“ ì½”ë”© ì»¨ë²¤ì…˜
- TypeScript strict ëª¨ë“œ ì‚¬ìš©
- ESLint + Prettier ì„¤ì • ì¤€ìˆ˜
- ì˜ë¯¸ìˆëŠ” ë³€ìˆ˜ëª… ë° í•¨ìˆ˜ëª… ì‚¬ìš©
- ì£¼ì„ ì‘ì„± (ë³µì¡í•œ ë¡œì§)
- ì—ëŸ¬ í•¸ë“¤ë§ ì² ì €íˆ êµ¬í˜„ 